apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: minio
  namespace: argocd
spec:
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
  project: default
  sources:
    - chart: minio
      repoURL: registry-1.docker.io/bitnamicharts
      targetRevision: 14.10.x
      helm:
        values: |
          auth:
            existingSecret: "minio-secret"
            rootUserSecretKey: "user"
            rootPasswordSecretKey: "password"
          ingress:
            enabled: true
            ingressClassName: "nginx"
            hostname: minio.sts34.de
            annotations:
              cert-manager.io/cluster-issuer: "hetzner-prod-issuer"
            tls: true
          apiIngress:
            enabled: true
            ingressClassName: "nginx"
            hostname: minio-api.sts34.de
            annotations:
              cert-manager.io/cluster-issuer: "hetzner-prod-issuer"
            tls: true
          persistence:
            storageClass: "directpv-min-io"
            size: 10Gi
          metrics:
            enabled: true
            serviceMonitor:
              enabled: true
              labels:
                release: prometheus
            prometheusRule:
              enabled: true
              additionalLabels:
                release: prometheus
  destination:
    server: https://kubernetes.default.svc
    namespace: minio


